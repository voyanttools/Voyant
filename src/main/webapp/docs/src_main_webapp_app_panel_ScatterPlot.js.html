

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: src/main/webapp/app/panel/ScatterPlot.js | Voyant Tools Help</title>

    <link rel="shortcut icon" type="image/ico" href="favicon.ico">
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="width: 150px; height: 150px">
        
            <a href="index.html">
                <img src="imgs/info/about/icon.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Voyant Tools Help</a></h1>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="examples-tab">
                <a href="#"><h4>Voyant</h4></a>
            </li>            <li id="api-tab">
                <a href="#"><h4>Spyral</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Voyant</h3><ul><li><a href="tutorial-guides.html">Guides</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="guides_sub"><ul class="inner"><li><a href="tutorial-start.html">Getting Started</a></li><li><a href="tutorial-corpuscreator.html">Creating a Corpus</a></li><li><a href="tutorial-modifyingcorpus.html">Modifying a Corpus</a></li><li><a href="tutorial-embedding.html">Embedding Voyant</a></li><li><a href="tutorial-skins.html">Skins</a></li><li><a href="tutorial-languages.html">Languages</a></li><li><a href="tutorial-stopwords.html">Stopwords</a></li><li><a href="tutorial-search.html">Search</a></li><li><a href="tutorial-categories.html">Categories</a></li><li><a href="tutorial-palette.html">Palette</a></li><li><a href="tutorial-grids.html">Grids</a></li><li><a href="tutorial-new.html">What's New</a></li><li><a href="tutorial-tutorial.html">Tutorial/Workshop</a></li></ul></div></li><li><a href="tutorial-info.html">Information</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="info_sub"><ul class="inner"><li><a href="tutorial-about.html">About</a></li><li><a href="tutorial-notebook.html">About Spyral</a></li><li><a href="tutorial-gallery.html">Gallery</a></li><li><a href="tutorial-mirrors.html">Mirrors</a></li><li><a href="tutorial-server.html">VoyantServer</a></li></ul></div></li><li><a href="tutorial-tools_.html">Tools</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="tools_sub"><ul class="inner"><li><a href="tutorial-bubblelines.html">Bubblelines</a></li><li><a href="tutorial-bubbles.html">Bubbles</a></li><li><a href="tutorial-catalogue.html">Catalogue</a></li><li><a href="tutorial-cirrus.html">Cirrus</a></li><li><a href="tutorial-corpuscollocates.html">Corpus Collocates</a></li><li><a href="tutorial-collocatesgraph.html">Collocates Graph</a></li><li><a href="tutorial-contexts.html">Contexts</a></li><li><a href="tutorial-corpusterms.html">Corpus Terms</a></li><li><a href="tutorial-correlations.html">Correlations</a></li><li><a href="tutorial-documents.html">Documents</a></li><li><a href="tutorial-documentterms.html">Document Terms</a></li><li><a href="tutorial-dreamscape.html">Dreamscape</a></li><li><a href="tutorial-knots.html">Knots</a></li><li><a href="tutorial-mandala.html">Mandala</a></li><li><a href="tutorial-microsearch.html">MicroSearch</a></li><li><a href="tutorial-phrases.html">Phrases</a></li><li><a href="tutorial-reader.html">Reader</a></li><li><a href="tutorial-rezoviz.html">RezoViz</a></li><li><a href="tutorial-scatterplot.html">ScatterPlot</a></li><li><a href="tutorial-streamgraph.html">StreamGraph</a></li><li><a href="tutorial-summary.html">Summary</a></li><li><a href="tutorial-termsberry.html">TermsBerry</a></li><li><a href="tutorial-termsradio.html">TermsRadio</a></li><li><a href="tutorial-textualarc.html">TextualArc</a></li><li><a href="tutorial-topics.html">Topics</a></li><li><a href="tutorial-trends.html">Trends</a></li><li><a href="tutorial-veliza.html">Veliza</a></li><li><a href="tutorial-wordtree.html">WordTree</a></li><li><a href="tutorial-via.html">Via</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Namespaces</h3><ul><li><a href="Spyral.html">Spyral</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Spyral.Categories.html">Categories</a></li><li><a href="Spyral.Chart.html">Chart</a></li><li><a href="Spyral.Corpus.html">Corpus</a></li><li><a href="Spyral.Load.html">Load</a></li><li><a href="Spyral.Metadata.html">Metadata</a></li><li><a href="Spyral.NetworkGraph.html">NetworkGraph</a></li><li><a href="Spyral.Notebook.html">Notebook</a></li><li><a href="Spyral.Table.html">Table</a></li><li><a href="Spyral.Util.html">Util</a></li></ul></div></li><li><a href="Tools.html">Tools</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Bubblelines.html">Bubblelines</a></li><li><a href="Tools.Bubbles.html">Bubbles</a></li><li><a href="Tools.Cirrus.html">Cirrus</a></li><li><a href="Tools.CollocatesGraph.html">CollocatesGraph</a></li><li><a href="Tools.Contexts.html">Contexts</a></li><li><a href="Tools.CorpusCollocates.html">CorpusCollocates</a></li><li><a href="Tools.CorpusTerms.html">CorpusTerms</a></li><li><a href="Tools.Correlations.html">Correlations</a></li><li><a href="Tools.CustomSet.html">CustomSet</a></li><li><a href="Tools.DocumentTerms.html">DocumentTerms</a></li><li><a href="Tools.Documents.html">Documents</a></li><li><a href="Tools.Embedder.html">Embedder</a></li><li><a href="Tools.Knots.html">Knots</a></li><li><a href="Tools.Mandala.html">Mandala</a></li><li><a href="Tools.MicroSearch.html">MicroSearch</a></li><li><a href="Tools.Panel.html">Panel</a></li><li><a href="Tools.Phrases.html">Phrases</a></li><li><a href="Tools.Reader.html">Reader</a></li><li><a href="Tools.RezoViz.html">RezoViz</a></li><li><a href="Tools.ScatterPlot.html">ScatterPlot</a></li><li><a href="Tools.StreamGraph.html">StreamGraph</a></li><li><a href="Tools.Summary.html">Summary</a></li><li><a href="Tools.TermsBerry.html">TermsBerry</a></li><li><a href="Tools.TermsRadio.html">TermsRadio</a></li><li><a href="Tools.TextualArc.html">TextualArc</a></li><li><a href="Tools.Topics.html">Topics</a></li><li><a href="Tools.Trends.html">Trends</a></li><li><a href="Tools.WordTree.html">WordTree</a></li></ul></div></li><li><a href="window.html">window</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="window_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="window.html#.createTable">createTable</a></li><li><a href="window.html#.loadCorpus">loadCorpus</a></li><li><a href="window.html#.show">show</a></li><li><a href="window.html#.showError">showError</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Spyral.Categories.html">Spyral.Categories</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Categories_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Categories.html#addCategory">addCategory</a></li><li><a href="Spyral.Categories.html#addFeature">addFeature</a></li><li><a href="Spyral.Categories.html#addTerm">addTerm</a></li><li><a href="Spyral.Categories.html#addTerms">addTerms</a></li><li><a href="Spyral.Categories.html#getCategories">getCategories</a></li><li><a href="Spyral.Categories.html#getCategoriesForTerm">getCategoriesForTerm</a></li><li><a href="Spyral.Categories.html#getCategoryExportData">getCategoryExportData</a></li><li><a href="Spyral.Categories.html#getCategoryFeature">getCategoryFeature</a></li><li><a href="Spyral.Categories.html#getCategoryForTerm">getCategoryForTerm</a></li><li><a href="Spyral.Categories.html#getCategoryNames">getCategoryNames</a></li><li><a href="Spyral.Categories.html#getCategoryRanking">getCategoryRanking</a></li><li><a href="Spyral.Categories.html#getCategoryTerms">getCategoryTerms</a></li><li><a href="Spyral.Categories.html#getFeatureForTerm">getFeatureForTerm</a></li><li><a href="Spyral.Categories.html#getFeatures">getFeatures</a></li><li><a href="Spyral.Categories.html#load">load</a></li><li><a href="Spyral.Categories.html#removeCategory">removeCategory</a></li><li><a href="Spyral.Categories.html#removeFeature">removeFeature</a></li><li><a href="Spyral.Categories.html#removeTerm">removeTerm</a></li><li><a href="Spyral.Categories.html#removeTerms">removeTerms</a></li><li><a href="Spyral.Categories.html#renameCategory">renameCategory</a></li><li><a href="Spyral.Categories.html#save">save</a></li><li><a href="Spyral.Categories.html#setCategoryFeature">setCategoryFeature</a></li><li><a href="Spyral.Categories.html#setCategoryRanking">setCategoryRanking</a></li><li><a href="Spyral.Categories.html#.load">load</a></li></ul></div></li><li><a href="Spyral.Chart.html">Spyral.Chart</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Chart_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Chart.html#bar">bar</a></li><li><a href="Spyral.Chart.html#column">column</a></li><li><a href="Spyral.Chart.html#create">create</a></li><li><a href="Spyral.Chart.html#line">line</a></li><li><a href="Spyral.Chart.html#networkgraph">networkgraph</a></li><li><a href="Spyral.Chart.html#scatter">scatter</a></li><li><a href="Spyral.Chart.html#.bar">bar</a></li><li><a href="Spyral.Chart.html#.column">column</a></li><li><a href="Spyral.Chart.html#.create">create</a></li><li><a href="Spyral.Chart.html#.line">line</a></li><li><a href="Spyral.Chart.html#.networkgraph">networkgraph</a></li><li><a href="Spyral.Chart.html#.scatter">scatter</a></li><li><a href="Spyral.Chart.html#.setSeriesData">setSeriesData</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="Spyral.Chart.html#~HighchartsConfig">HighchartsConfig</a></li><li><a href="Spyral.Chart.html#~HighchartsSeriesConfig">HighchartsSeriesConfig</a></li></ul></div></li><li><a href="Spyral.Corpus.html">Spyral.Corpus</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Corpus_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Corpus.html#analysis">analysis</a></li><li><a href="Spyral.Corpus.html#collocates">collocates</a></li><li><a href="Spyral.Corpus.html#contexts">contexts</a></li><li><a href="Spyral.Corpus.html#correlations">correlations</a></li><li><a href="Spyral.Corpus.html#documents">documents</a></li><li><a href="Spyral.Corpus.html#entities">entities</a></li><li><a href="Spyral.Corpus.html#filterByCategory">filterByCategory</a></li><li><a href="Spyral.Corpus.html#id">id</a></li><li><a href="Spyral.Corpus.html#lemmas">lemmas</a></li><li><a href="Spyral.Corpus.html#metadata">metadata</a></li><li><a href="Spyral.Corpus.html#phrases">phrases</a></li><li><a href="Spyral.Corpus.html#summary">summary</a></li><li><a href="Spyral.Corpus.html#terms">terms</a></li><li><a href="Spyral.Corpus.html#text">text</a></li><li><a href="Spyral.Corpus.html#texts">texts</a></li><li><a href="Spyral.Corpus.html#titles">titles</a></li><li><a href="Spyral.Corpus.html#toString">toString</a></li><li><a href="Spyral.Corpus.html#tokens">tokens</a></li><li><a href="Spyral.Corpus.html#tool">tool</a></li><li><a href="Spyral.Corpus.html#topics">topics</a></li><li><a href="Spyral.Corpus.html#words">words</a></li><li><a href="Spyral.Corpus.html#.load">load</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="Spyral.Corpus.html#~CorpusConfig">CorpusConfig</a></li></ul></div></li><li><a href="Spyral.Load.html">Spyral.Load</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Load_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Load.html#.html">html</a></li><li><a href="Spyral.Load.html#.json">json</a></li><li><a href="Spyral.Load.html#.load">load</a></li><li><a href="Spyral.Load.html#.setBaseUrl">setBaseUrl</a></li><li><a href="Spyral.Load.html#.text">text</a></li><li><a href="Spyral.Load.html#.trombone">trombone</a></li><li><a href="Spyral.Load.html#.xml">xml</a></li></ul></div></li><li><a href="Spyral.Metadata.html">Spyral.Metadata</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Metadata_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Metadata.html#clone">clone</a></li><li><a href="Spyral.Metadata.html#getHeaders">getHeaders</a></li><li><a href="Spyral.Metadata.html#set">set</a></li><li><a href="Spyral.Metadata.html#setDateNow">setDateNow</a></li><li><a href="Spyral.Metadata.html#shortDate">shortDate</a></li></ul></div></li><li><a href="Spyral.Notebook.html">Spyral.Notebook</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Notebook_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Notebook.html#.getPromise">getPromise</a></li><li><a href="Spyral.Notebook.html#.getTarget">getTarget</a></li><li><a href="Spyral.Notebook.html#.import">import</a></li><li><a href="Spyral.Notebook.html#.show">show</a></li></ul></div></li><li><a href="Spyral.Table.html">Spyral.Table</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Table_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Table.html#addColumn">addColumn</a></li><li><a href="Spyral.Table.html#addRow">addRow</a></li><li><a href="Spyral.Table.html#addRows">addRows</a></li><li><a href="Spyral.Table.html#cell">cell</a></li><li><a href="Spyral.Table.html#chart">chart</a></li><li><a href="Spyral.Table.html#column">column</a></li><li><a href="Spyral.Table.html#columnCounts">columnCounts</a></li><li><a href="Spyral.Table.html#columnMax">columnMax</a></li><li><a href="Spyral.Table.html#columnMean">columnMean</a></li><li><a href="Spyral.Table.html#columnMin">columnMin</a></li><li><a href="Spyral.Table.html#columnRollingMean">columnRollingMean</a></li><li><a href="Spyral.Table.html#columnSort">columnSort</a></li><li><a href="Spyral.Table.html#columnStandardDeviation">columnStandardDeviation</a></li><li><a href="Spyral.Table.html#columnSum">columnSum</a></li><li><a href="Spyral.Table.html#columnVariance">columnVariance</a></li><li><a href="Spyral.Table.html#columnZScores">columnZScores</a></li><li><a href="Spyral.Table.html#columns">columns</a></li><li><a href="Spyral.Table.html#forEach">forEach</a></li><li><a href="Spyral.Table.html#getColumnIndex">getColumnIndex</a></li><li><a href="Spyral.Table.html#getRowIndex">getRowIndex</a></li><li><a href="Spyral.Table.html#hasColumn">hasColumn</a></li><li><a href="Spyral.Table.html#header">header</a></li><li><a href="Spyral.Table.html#headers">headers</a></li><li><a href="Spyral.Table.html#html">html</a></li><li><a href="Spyral.Table.html#row">row</a></li><li><a href="Spyral.Table.html#rowCounts">rowCounts</a></li><li><a href="Spyral.Table.html#rowMax">rowMax</a></li><li><a href="Spyral.Table.html#rowMean">rowMean</a></li><li><a href="Spyral.Table.html#rowMin">rowMin</a></li><li><a href="Spyral.Table.html#rowRollingMean">rowRollingMean</a></li><li><a href="Spyral.Table.html#rowSort">rowSort</a></li><li><a href="Spyral.Table.html#rowStandardDeviation">rowStandardDeviation</a></li><li><a href="Spyral.Table.html#rowSum">rowSum</a></li><li><a href="Spyral.Table.html#rowVariance">rowVariance</a></li><li><a href="Spyral.Table.html#rowZScores">rowZScores</a></li><li><a href="Spyral.Table.html#rows">rows</a></li><li><a href="Spyral.Table.html#setCell">setCell</a></li><li><a href="Spyral.Table.html#setColumn">setColumn</a></li><li><a href="Spyral.Table.html#setHeaders">setHeaders</a></li><li><a href="Spyral.Table.html#setRow">setRow</a></li><li><a href="Spyral.Table.html#toCsv">toCsv</a></li><li><a href="Spyral.Table.html#toHtml">toHtml</a></li><li><a href="Spyral.Table.html#toString">toString</a></li><li><a href="Spyral.Table.html#toTsv">toTsv</a></li><li><a href="Spyral.Table.html#updateCell">updateCell</a></li><li><a href="Spyral.Table.html#.cmp">cmp</a></li><li><a href="Spyral.Table.html#.counts">counts</a></li><li><a href="Spyral.Table.html#.create">create</a></li><li><a href="Spyral.Table.html#.fetch">fetch</a></li><li><a href="Spyral.Table.html#.mean">mean</a></li><li><a href="Spyral.Table.html#.rollingMean">rollingMean</a></li><li><a href="Spyral.Table.html#.standardDeviation">standardDeviation</a></li><li><a href="Spyral.Table.html#.sum">sum</a></li><li><a href="Spyral.Table.html#.variance">variance</a></li><li><a href="Spyral.Table.html#.zScores">zScores</a></li><li><a href="Spyral.Table.html#.zip">zip</a></li></ul><div class="member-type">Typedef</div><ul class="inner"><li><a href="Spyral.Table.html#~TableConfig">TableConfig</a></li></ul></div></li><li><a href="Spyral.Util.html">Spyral.Util</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Util_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Spyral.Util.Storage.html">Storage</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Util.html#.blobToDataUrl">blobToDataUrl</a></li><li><a href="Spyral.Util.html#.blobToString">blobToString</a></li><li><a href="Spyral.Util.html#.dataUrlToBlob">dataUrlToBlob</a></li><li><a href="Spyral.Util.html#.getFileExtensionFromMimeType">getFileExtensionFromMimeType</a></li><li><a href="Spyral.Util.html#.getVoyantDocumentFormatFromFileExtension">getVoyantDocumentFormatFromFileExtension</a></li><li><a href="Spyral.Util.html#.id">id</a></li><li><a href="Spyral.Util.html#.isArray">isArray</a></li><li><a href="Spyral.Util.html#.isBlob">isBlob</a></li><li><a href="Spyral.Util.html#.isBoolean">isBoolean</a></li><li><a href="Spyral.Util.html#.isFunction">isFunction</a></li><li><a href="Spyral.Util.html#.isNode">isNode</a></li><li><a href="Spyral.Util.html#.isNull">isNull</a></li><li><a href="Spyral.Util.html#.isNumber">isNumber</a></li><li><a href="Spyral.Util.html#.isObject">isObject</a></li><li><a href="Spyral.Util.html#.isPromise">isPromise</a></li><li><a href="Spyral.Util.html#.isString">isString</a></li><li><a href="Spyral.Util.html#.isUndefined">isUndefined</a></li><li><a href="Spyral.Util.html#.more">more</a></li><li><a href="Spyral.Util.html#.show">show</a></li><li><a href="Spyral.Util.html#.showError">showError</a></li><li><a href="Spyral.Util.html#.toString">toString</a></li><li><a href="Spyral.Util.html#.transformXml">transformXml</a></li></ul></div></li><li><a href="Spyral.Util.Storage.html">Spyral.Util.Storage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Spyral.Util.Storage_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Spyral.Util.Storage.html#.getStoredResource">getStoredResource</a></li><li><a href="Spyral.Util.Storage.html#.getTromboneUrl">getTromboneUrl</a></li><li><a href="Spyral.Util.Storage.html#.storeResource">storeResource</a></li></ul></div></li><li><a href="Tools.Bubblelines.html">Tools.Bubblelines</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Bubblelines_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Bubblelines.html#bins">bins</a></li><li><a href="Tools.Bubblelines.html#docId">docId</a></li><li><a href="Tools.Bubblelines.html#docIndex">docIndex</a></li><li><a href="Tools.Bubblelines.html#maxDocs">maxDocs</a></li><li><a href="Tools.Bubblelines.html#query">query</a></li><li><a href="Tools.Bubblelines.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.Bubbles.html">Tools.Bubbles</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Bubbles_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Bubbles.html#audio">audio</a></li><li><a href="Tools.Bubbles.html#docIndex">docIndex</a></li><li><a href="Tools.Bubbles.html#limit">limit</a></li><li><a href="Tools.Bubbles.html#speed">speed</a></li><li><a href="Tools.Bubbles.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.Cirrus.html">Tools.Cirrus</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Cirrus_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Cirrus.html#categories">categories</a></li><li><a href="Tools.Cirrus.html#docId">docId</a></li><li><a href="Tools.Cirrus.html#docIndex">docIndex</a></li><li><a href="Tools.Cirrus.html#fontFamily">fontFamily</a></li><li><a href="Tools.Cirrus.html#inlineData">inlineData</a></li><li><a href="Tools.Cirrus.html#limit">limit</a></li><li><a href="Tools.Cirrus.html#stopList">stopList</a></li><li><a href="Tools.Cirrus.html#visible">visible</a></li><li><a href="Tools.Cirrus.html#whiteList">whiteList</a></li></ul></div></li><li><a href="Tools.CollocatesGraph.html">Tools.CollocatesGraph</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.CollocatesGraph_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.CollocatesGraph.html#centralize">centralize</a></li><li><a href="Tools.CollocatesGraph.html#context">context</a></li><li><a href="Tools.CollocatesGraph.html#limit">limit</a></li><li><a href="Tools.CollocatesGraph.html#query">query</a></li><li><a href="Tools.CollocatesGraph.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.Contexts.html">Tools.Contexts</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Contexts_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Contexts.html#columns">columns</a></li><li><a href="Tools.Contexts.html#context">context</a></li><li><a href="Tools.Contexts.html#dir">dir</a></li><li><a href="Tools.Contexts.html#docId">docId</a></li><li><a href="Tools.Contexts.html#docId">docId</a></li><li><a href="Tools.Contexts.html#docIndex">docIndex</a></li><li><a href="Tools.Contexts.html#expand">expand</a></li><li><a href="Tools.Contexts.html#query">query</a></li><li><a href="Tools.Contexts.html#sort">sort</a></li><li><a href="Tools.Contexts.html#stopList">stopList</a></li><li><a href="Tools.Contexts.html#termColors">termColors</a></li></ul></div></li><li><a href="Tools.CorpusCollocates.html">Tools.CorpusCollocates</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.CorpusCollocates_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.CorpusCollocates.html#columns">columns</a></li><li><a href="Tools.CorpusCollocates.html#context">context</a></li><li><a href="Tools.CorpusCollocates.html#dir">dir</a></li><li><a href="Tools.CorpusCollocates.html#docId">docId</a></li><li><a href="Tools.CorpusCollocates.html#docIndex">docIndex</a></li><li><a href="Tools.CorpusCollocates.html#query">query</a></li><li><a href="Tools.CorpusCollocates.html#sort">sort</a></li><li><a href="Tools.CorpusCollocates.html#stopList">stopList</a></li><li><a href="Tools.CorpusCollocates.html#termColors">termColors</a></li></ul></div></li><li><a href="Tools.CorpusTerms.html">Tools.CorpusTerms</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.CorpusTerms_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.CorpusTerms.html#columns">columns</a></li><li><a href="Tools.CorpusTerms.html#comparisonCorpus">comparisonCorpus</a></li><li><a href="Tools.CorpusTerms.html#dir">dir</a></li><li><a href="Tools.CorpusTerms.html#maxBins">maxBins</a></li><li><a href="Tools.CorpusTerms.html#query">query</a></li><li><a href="Tools.CorpusTerms.html#sort">sort</a></li><li><a href="Tools.CorpusTerms.html#stopList">stopList</a></li><li><a href="Tools.CorpusTerms.html#termColors">termColors</a></li></ul></div></li><li><a href="Tools.Correlations.html">Tools.Correlations</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Correlations_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Correlations.html#columns">columns</a></li><li><a href="Tools.Correlations.html#dir">dir</a></li><li><a href="Tools.Correlations.html#docId">docId</a></li><li><a href="Tools.Correlations.html#docIndex">docIndex</a></li><li><a href="Tools.Correlations.html#minInDocumentsCountRatio">minInDocumentsCountRatio</a></li><li><a href="Tools.Correlations.html#query">query</a></li><li><a href="Tools.Correlations.html#sort">sort</a></li><li><a href="Tools.Correlations.html#stopList">stopList</a></li><li><a href="Tools.Correlations.html#termColors">termColors</a></li><li><a href="Tools.Correlations.html#withDistributions">withDistributions</a></li></ul></div></li><li><a href="Tools.CustomSet.html">Tools.CustomSet</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.CustomSet_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.CustomSet.html#layout">layout</a></li><li><a href="Tools.CustomSet.html#tableLayout">tableLayout</a></li></ul></div></li><li><a href="Tools.DocumentTerms.html">Tools.DocumentTerms</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.DocumentTerms_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.DocumentTerms.html#bins">bins</a></li><li><a href="Tools.DocumentTerms.html#columns">columns</a></li><li><a href="Tools.DocumentTerms.html#dir">dir</a></li><li><a href="Tools.DocumentTerms.html#docId">docId</a></li><li><a href="Tools.DocumentTerms.html#docIndex">docIndex</a></li><li><a href="Tools.DocumentTerms.html#query">query</a></li><li><a href="Tools.DocumentTerms.html#sort">sort</a></li><li><a href="Tools.DocumentTerms.html#stopList">stopList</a></li><li><a href="Tools.DocumentTerms.html#termColors">termColors</a></li></ul></div></li><li><a href="Tools.Documents.html">Tools.Documents</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Documents_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Documents.html#columns">columns</a></li><li><a href="Tools.Documents.html#dir">dir</a></li><li><a href="Tools.Documents.html#docId">docId</a></li><li><a href="Tools.Documents.html#docIndex">docIndex</a></li><li><a href="Tools.Documents.html#query">query</a></li><li><a href="Tools.Documents.html#sort">sort</a></li></ul></div></li><li><a href="Tools.Embedder.html">Tools.Embedder</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Embedder_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Embedder.html#url">url</a></li></ul></div></li><li><a href="Tools.Knots.html">Tools.Knots</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Knots_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Knots.html#audio">audio</a></li><li><a href="Tools.Knots.html#docId">docId</a></li><li><a href="Tools.Knots.html#query">query</a></li><li><a href="Tools.Knots.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.Mandala.html">Tools.Mandala</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Mandala_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Mandala.html#labels">labels</a></li><li><a href="Tools.Mandala.html#query">query</a></li><li><a href="Tools.Mandala.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.MicroSearch.html">Tools.MicroSearch</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.MicroSearch_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.MicroSearch.html#query">query</a></li><li><a href="Tools.MicroSearch.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.Panel.html">Tools.Panel</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Panel_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Panel.html#corpus">corpus</a></li><li><a href="Tools.Panel.html#input">input</a></li><li><a href="Tools.Panel.html#inputFormat">inputFormat</a></li><li><a href="Tools.Panel.html#subtitle">subtitle</a></li></ul></div></li><li><a href="Tools.Phrases.html">Tools.Phrases</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Phrases_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Phrases.html#columns">columns</a></li><li><a href="Tools.Phrases.html#dir">dir</a></li><li><a href="Tools.Phrases.html#docId">docId</a></li><li><a href="Tools.Phrases.html#docIndex">docIndex</a></li><li><a href="Tools.Phrases.html#maxLength">maxLength</a></li><li><a href="Tools.Phrases.html#minLength">minLength</a></li><li><a href="Tools.Phrases.html#overlapFilter">overlapFilter</a></li><li><a href="Tools.Phrases.html#query">query</a></li><li><a href="Tools.Phrases.html#sort">sort</a></li><li><a href="Tools.Phrases.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.Reader.html">Tools.Reader</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Reader_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Reader.html#limit">limit</a></li><li><a href="Tools.Reader.html#query">query</a></li><li><a href="Tools.Reader.html#skipToDocId">skipToDocId</a></li><li><a href="Tools.Reader.html#start">start</a></li></ul></div></li><li><a href="Tools.RezoViz.html">Tools.RezoViz</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.RezoViz_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.RezoViz.html#docId">docId</a></li><li><a href="Tools.RezoViz.html#limit">limit</a></li><li><a href="Tools.RezoViz.html#minEdgeCount">minEdgeCount</a></li><li><a href="Tools.RezoViz.html#nerService">nerService</a></li><li><a href="Tools.RezoViz.html#query">query</a></li><li><a href="Tools.RezoViz.html#stopList">stopList</a></li><li><a href="Tools.RezoViz.html#type">type</a></li></ul></div></li><li><a href="Tools.ScatterPlot.html">Tools.ScatterPlot</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.ScatterPlot_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.ScatterPlot.html#analysis">analysis</a></li><li><a href="Tools.ScatterPlot.html#bins">bins</a></li><li><a href="Tools.ScatterPlot.html#clusters">clusters</a></li><li><a href="Tools.ScatterPlot.html#comparisonType">comparisonType</a></li><li><a href="Tools.ScatterPlot.html#dimensions">dimensions</a></li><li><a href="Tools.ScatterPlot.html#docId">docId</a></li><li><a href="Tools.ScatterPlot.html#iterations">iterations</a></li><li><a href="Tools.ScatterPlot.html#label">label</a></li><li><a href="Tools.ScatterPlot.html#limit">limit</a></li><li><a href="Tools.ScatterPlot.html#perplexity">perplexity</a></li><li><a href="Tools.ScatterPlot.html#query">query</a></li><li><a href="Tools.ScatterPlot.html#stopList">stopList</a></li><li><a href="Tools.ScatterPlot.html#storeJson">storeJson</a></li><li><a href="Tools.ScatterPlot.html#target">target</a></li><li><a href="Tools.ScatterPlot.html#term">term</a></li><li><a href="Tools.ScatterPlot.html#whitelist">whitelist</a></li></ul></div></li><li><a href="Tools.StreamGraph.html">Tools.StreamGraph</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.StreamGraph_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.StreamGraph.html#bins">bins</a></li><li><a href="Tools.StreamGraph.html#docId">docId</a></li><li><a href="Tools.StreamGraph.html#docIndex">docIndex</a></li><li><a href="Tools.StreamGraph.html#limit">limit</a></li><li><a href="Tools.StreamGraph.html#query">query</a></li><li><a href="Tools.StreamGraph.html#stopList">stopList</a></li><li><a href="Tools.StreamGraph.html#withDistributions">withDistributions</a></li></ul></div></li><li><a href="Tools.Summary.html">Tools.Summary</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Summary_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Summary.html#limit">limit</a></li><li><a href="Tools.Summary.html#numberOfDocumentsForDistinctiveWords">numberOfDocumentsForDistinctiveWords</a></li><li><a href="Tools.Summary.html#start">start</a></li><li><a href="Tools.Summary.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.TermsBerry.html">Tools.TermsBerry</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.TermsBerry_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.TermsBerry.html#categories">categories</a></li><li><a href="Tools.TermsBerry.html#context">context</a></li><li><a href="Tools.TermsBerry.html#docId">docId</a></li><li><a href="Tools.TermsBerry.html#docIndex">docIndex</a></li><li><a href="Tools.TermsBerry.html#numInitialTerms">numInitialTerms</a></li><li><a href="Tools.TermsBerry.html#query">query</a></li><li><a href="Tools.TermsBerry.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.TermsRadio.html">Tools.TermsRadio</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.TermsRadio_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.TermsRadio.html#bins">bins</a></li><li><a href="Tools.TermsRadio.html#limit">limit</a></li><li><a href="Tools.TermsRadio.html#query">query</a></li><li><a href="Tools.TermsRadio.html#slider">slider</a></li><li><a href="Tools.TermsRadio.html#speed">speed</a></li><li><a href="Tools.TermsRadio.html#stopList">stopList</a></li><li><a href="Tools.TermsRadio.html#visibleBins">visibleBins</a></li><li><a href="Tools.TermsRadio.html#yAxisScale">yAxisScale</a></li></ul></div></li><li><a href="Tools.TextualArc.html">Tools.TextualArc</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.TextualArc_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.TextualArc.html#docIndex">docIndex</a></li><li><a href="Tools.TextualArc.html#minRawFreq">minRawFreq</a></li><li><a href="Tools.TextualArc.html#speed">speed</a></li><li><a href="Tools.TextualArc.html#stopList">stopList</a></li></ul></div></li><li><a href="Tools.Topics.html">Tools.Topics</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Topics_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Topics.html#iterations">iterations</a></li><li><a href="Tools.Topics.html#perDocLimit">perDocLimit</a></li><li><a href="Tools.Topics.html#seed">seed</a></li><li><a href="Tools.Topics.html#stopList">stopList</a></li><li><a href="Tools.Topics.html#termsPerTopic">termsPerTopic</a></li><li><a href="Tools.Topics.html#topics">topics</a></li></ul></div></li><li><a href="Tools.Trends.html">Tools.Trends</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.Trends_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.Trends.html#bins">bins</a></li><li><a href="Tools.Trends.html#chartType">chartType</a></li><li><a href="Tools.Trends.html#docId">docId</a></li><li><a href="Tools.Trends.html#docIndex">docIndex</a></li><li><a href="Tools.Trends.html#labels">labels</a></li><li><a href="Tools.Trends.html#limit">limit</a></li><li><a href="Tools.Trends.html#mode">mode</a></li><li><a href="Tools.Trends.html#query">query</a></li><li><a href="Tools.Trends.html#stopList">stopList</a></li><li><a href="Tools.Trends.html#withDistributions">withDistributions</a></li></ul></div></li><li><a href="Tools.WordTree.html">Tools.WordTree</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Tools.WordTree_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Tools.WordTree.html#context">context</a></li><li><a href="Tools.WordTree.html#docId">docId</a></li><li><a href="Tools.WordTree.html#docIndex">docIndex</a></li><li><a href="Tools.WordTree.html#limit">limit</a></li><li><a href="Tools.WordTree.html#query">query</a></li><li><a href="Tools.WordTree.html#stopList">stopList</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * ScatterPlot is a graph visualization of how words cluster in a corpus document similarity, correspondence analysis or principal component analysis.
 *
 * @example
 *
 *   let config = {
 *     "analysis": null,
 *     "bins": null,
 *     "clusters": null,
 *     "comparisonType": null,
 *     "dimensions": null,
 *     "docId": null,
 *     "iterations": null,
 *     "label": null,
 *     "limit": null,
 *     "perplexity": null,
 *     "query": null,
 *     "stopList": null,
 *     "storeJson": null,
 *     "target": null,
 *     "term": null,
 *     "whitelist": null,
 *   };
 *
 *   loadCorpus("austen").tool("scatterplot", config);
 *
 * @class ScatterPlot
 * @tutorial scatterplot
 * @memberof Tools
 */
Ext.define('Voyant.panel.ScatterPlot', {
	extend: 'Ext.panel.Panel',
	mixins: ['Voyant.panel.Panel'],
	requires: ['Ext.chart.CartesianChart'],
	alias: 'widget.scatterplot',
    statics: {
    	i18n: {
    	},
    	api: {
			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {docId}
			 */
    		docId: undefined,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {String} analysis The type of analysis to perform. Options are: 'ca', 'pca', 'tsne', and 'docSim'.
			 */
    		analysis: 'ca',

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {limit}
			 * @default
			 */
    		limit: 50,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {Number} dimensions The number of dimensions to render, either 2 or 3.
			 * @default
			 */
    		dimensions: 3,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {bins}
			 * @default
			 */
    		bins: 10,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {Number} clusters The number of clusters within which to group words.
			 * @default
			 */
    		clusters: 3,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {Number} perplexity The TSNE perplexity value.
			 * @default
			 */
    		perplexity: 15,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {Number} iterations The TSNE iterations value.
			 * @default
			 */
    		iterations: 1500,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {String} comparisonType The value to use for comparing terms. Options are: 'raw', 'relative', and 'tfidf'.
			 * @default
			 */
    		comparisonType: 'relative',

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {stopList}
			 * @default
			 */
    		stopList: 'auto',

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {String} target The term to set as the target. This will filter results to terms that are near the target.
			 */
    		target: undefined,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {String[]} term Used in combination with "target" as a white list of terms to keep.
			 */
    		term: undefined,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {query}
			 */
    		query: undefined,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {String} whitelist TODO Unused or only used in CA?
			 */
    		whitelist: undefined,

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {String[]} label The label types to show. One or more of: 'summary', 'docs', and 'terms'.
			 */
    		label: ['summary', 'docs', 'terms'],

			/**
			 * @memberof Tools.ScatterPlot
			 * @instance
			 * @property {String} storeJson TODO used in embed
			 */
    		storeJson: undefined
    	},
		glyph: 'xf06e@FontAwesome'
    },
	config: {
    	options: [{xtype: 'stoplistoption'},{xtype: 'categoriesoption'}],
    	caStore: null,
    	pcaStore: null,
    	tsneStore: null,
    	docSimStore: null,
    	termStore: null,
    	chartMenu: null,
    	newTerm: null,
    	termsTimeout: null,
    	highlightData: {x: 0, y: 0, r: 0},
        highlightTask: null
	},
    
    tokenFreqTipTemplate: null,
    docFreqTipTemplate: null,
    
    constructor: function(config) {
		this.mixins['Voyant.util.Api'].constructor.apply(this, arguments);
		if ("storeJson" in config) {
    		var json = JSON.parse(config.storeJson);
    		Ext.apply(config, json);
    	}
		this.callParent(arguments);
    	this.mixins['Voyant.panel.Panel'].constructor.apply(this, arguments);
    },
    
    initComponent: function() {
    	this.setCaStore(Ext.create('Voyant.data.store.CAAnalysis', {
    		listeners: {load: this.maskAndBuildChart, scope: this}
    	}));
    	this.setPcaStore(Ext.create('Voyant.data.store.PCAAnalysis', {
    		listeners: {load: this.maskAndBuildChart, scope: this}
    	}));
    	this.setTsneStore(Ext.create('Voyant.data.store.TSNEAnalysis', {
    		listeners: {load: this.maskAndBuildChart, scope: this}
    	}));
    	this.setDocSimStore(Ext.create('Voyant.data.store.DocSimAnalysis', {
    		listeners: {load: this.maskAndBuildChart, scope: this}
    	}));
    	
    	this.setTermStore(Ext.create('Ext.data.JsonStore', {
			fields: [
				{name: 'term'},
				{name: 'rawFreq', type: 'int'},
				{name: 'relativeFreq', type: 'number'},
				{name: 'coordinates', mapping : 'vector'},
				{name: 'category'}
			],
			sorters: [{property: 'rawFreq', direction: 'DESC'}],
			groupField: 'category'
		}));
    	
    	this.setChartMenu(Ext.create('Ext.menu.Menu', {
    		items: [
    			{text: this.localize('remove'), itemId: 'remove', glyph: 'xf068@FontAwesome'},
    			{text: this.localize('nearby'), itemId: 'nearby', glyph: 'xf0b2@FontAwesome'}
    		],
    		listeners: {
    			hide: function() {
    				var series = this.down('#chart').getSeries();
    				series[0].enableToolTips();
    				series[1].enableToolTips();
    			},
    			scope: this
    		}
    	}));
    	
    	this.tokenFreqTipTemplate = new Ext.Template(this.localize('tokenFreqTip'));
    	this.docFreqTipTemplate = new Ext.Template(this.localize('docFreqTip'));
    	
        Ext.apply(this, {
        	title: this.localize('title'),
        	layout: 'border',
        	autoDestroy: true,
        	items: [{
    			itemId: 'chartParent',
    			region: 'center',
    			layout: 'fit',
        		tbar: {
        			overflowHandler: 'scroller',
        			items: [{
        				xtype: 'querysearchfield',
        				itemId: 'filterTerms',
        				width: 150
        			},{
                		text: this.localize('labels'),
                		itemId: 'labels',
                		glyph: 'xf02b@FontAwesome',
                		menu: {
                			items: [
                			    {text: this.localize("summaryLabel"), itemId: 'summary', xtype: 'menucheckitem'},
                			    {text: this.localize("docsLabel"), itemId: 'docs', xtype: 'menucheckitem'},
                			    {text: this.localize("termsLabel"), itemId: 'terms', xtype: 'menucheckitem'}
                			],
        					listeners: {
        						afterrender: function(menu) {
        							var labels = this.getApiParam('label');
        							menu.items.each(function(item) {
        								item.setChecked(labels.indexOf(item.getItemId())>-1)
        							})
        						},
        						click: function(menu, item) {
        							var labels = this.getApiParam("label");
        							var label = item.getItemId();
        							if (Ext.isString(labels)) {labels = [labels]}
        							if (item.checked &amp;&amp; labels.indexOf(label)==-1) {
        								labels.push(label)
        							} else if (!item.checked &amp;&amp; labels.indexOf(label)>-1) {
        								labels = labels.filter(function(item) {return item!=label})
        							}
        							this.setApiParam("label", labels);
        							this.doLabels();
        							this.queryById('chart').redraw();
        						},
        						scope: this
        					}
                		}
                	}]
        			
        		},
        		listeners: {
        			query: function(component, value) {
        				this.getTermStore().filter([{property: 'term', value: value, anyMatch: true}]);
        				this.filterChart(value);
        			},
        			scope: this
        		}
    		},{
    			itemId: 'optionsPanel',
        		title: this.localize('options'),
        		region: 'west',
        		split: true,
        		collapsible: true,
        		collapseMode: 'header',
        		width: 135,
        		scrollable: 'y',
        		layout: {
        			type: 'vbox',
        			align: 'stretch'
        		},
        		defaults: {
        			xtype: 'button',
        			margin: '5',
        			labelAlign: 'top'
        		},
        		items: [{
        			xtype: 'label',
        			text: this.localize('input')
        		},{
    				xtype: 'documentselectorbutton'
    			},{
	            	text: this.localize('freqsMode'),
	            	itemId: 'comparisonType',
					glyph: 'xf201@FontAwesome',
				    tooltip: this.localize('freqsModeTip'),
				    menu: {
				    	items: [
			               {text: this.localize("rawFrequencies"), itemId: 'comparisonType_raw', group: 'freqsMode', xtype: 'menucheckitem'},
			               {text: this.localize("relativeFrequencies"), itemId: 'comparisonType_relative', group: 'freqsMode', xtype: 'menucheckitem'},
			               {text: this.localize("tfidf"), itemId: 'comparisonType_tfidf', group: 'freqsMode', xtype: 'menucheckitem'}
			            ],
       					listeners: {
    						click: function(menu, item) {
    							if (item !== undefined) {
    								var type = item.getItemId().split('_')[1];
    								if (type !== this.getApiParam('comparisonType')) {
	    								this.setApiParam('comparisonType', type);
	    								this.loadFromApis(true);
    								}
    							}
    						},
    						scope: this
    				    }
				    }
        		},{
        			fieldLabel: this.localize('numTerms'),
        			itemId: 'limit',
        			xtype: 'numberfield',
        			minValue: 5,
        			listeners: {
        				change: function(numb, newValue, oldValue) {
        					function doLoad() {
        						this.setApiParam('limit', newValue);
            					this.loadFromApis();
							}
							if (oldValue !== null) {
								if (this.getTermsTimeout() !== null) {
									clearTimeout(this.getTermsTimeout());
								}
								if (numb.isValid()) {
									this.setTermsTimeout(setTimeout(doLoad.bind(this), 500));
								}
							}
        				},
        				scope: this
        			}
        		},{
        			xtype: 'container',
        			html: '&lt;hr style="border: none; border-top: 1px solid #cfcfcf;"/>'
        		},{
        			xtype: 'label',
        			text: this.localize('output')
        		},{
            		text: this.localize('analysis'),
            		itemId: 'analysis',
            		glyph: 'xf1ec@FontAwesome',
                    overflowHandler: 'scroller',
        			menu: {
    					items: [
    					    {text: this.localize('pca'), itemId: 'analysis_pca', group:'analysis', xtype: 'menucheckitem'},
    					    {text: this.localize('ca'), itemId: 'analysis_ca', group:'analysis', xtype: 'menucheckitem'},
    					    {text: this.localize('tsne'), itemId: 'analysis_tsne', group:'analysis', xtype: 'menucheckitem'},
    					    {text: this.localize('docSim'), itemId: 'analysis_docSim', group:'analysis', xtype: 'menucheckitem'}
    					],
    					listeners: {
    						click: function(menu, item) {
    							if (item !== undefined) {
    								var analysis = item.getItemId().split('_')[1];
    								if (analysis !== this.getApiParam('analysis')) {
    									this.doAnalysisChange(analysis);
    									this.loadFromApis(true);
    								}
    							}
    						},
    						scope: this
    					}
        			}
	            },{
	            	fieldLabel: this.localize('perplexity'),
	            	itemId: 'perplexity',
	            	xtype: 'slider',
	            	minValue: 5,
	            	maxValue: 100,
	            	increment: 1,
	            	listeners: {
	            		changecomplete: function(slider, newValue) {
	            			this.setApiParam('perplexity', newValue);
	            			this.loadFromApis(true);
	            		},
	            		scope: this
	            	}
	            },{
	            	fieldLabel: this.localize('iterations'),
	            	itemId: 'iterations',
	            	xtype: 'slider',
	            	minValue: 100,
	            	maxValue: 5000,
	            	increment: 100,
	            	listeners: {
	            		changecomplete: function(slider, newValue) {
	            			this.setApiParam('iterations', newValue);
	            			this.loadFromApis(true);
	            		},
	            		scope: this
	            	}
	            },{
            		text: this.localize('clusters'),
            		itemId: 'clusters',
            		glyph: 'xf192@FontAwesome',
            		menu: {
            			items: [
            			    {text: '1', itemId: 'clusters_1', group: 'clusters', xtype: 'menucheckitem'},
            			    {text: '2', itemId: 'clusters_2', group: 'clusters', xtype: 'menucheckitem'},
            			    {text: '3', itemId: 'clusters_3', group: 'clusters', xtype: 'menucheckitem'},
            			    {text: '4', itemId: 'clusters_4', group: 'clusters', xtype: 'menucheckitem'},
            			    {text: '5', itemId: 'clusters_5', group: 'clusters', xtype: 'menucheckitem'}
            			],
    					listeners: {
    						click: function(menu, item) {
    							if (item !== undefined) {
    								var clusters = parseInt(item.getItemId().split('_')[1]);
    								if (clusters !== this.getApiParam('clusters')) {
        								this.setApiParam('clusters', clusters);
        								this.loadFromApis(true);
    								}
    							}
    						},
    						scope: this
    					}
            		}
            	},{
            		text: this.localize('dimensions'),
            		itemId: 'dimensions',
            		glyph: 'xf1b2@FontAwesome',
            		menu: {
            			items: [
            			    {text: '2', itemId: 'dimensions_2', group: 'dimensions', xtype: 'menucheckitem'},
            			    {text: '3', itemId: 'dimensions_3', group: 'dimensions', xtype: 'menucheckitem'}
            			],
    					listeners: {
    						click: function(menu, item) {
    							if (item !== undefined) {
    								var dims = parseInt(item.getItemId().split('_')[1]);
    								if (dims !== this.getApiParam('dimensions')) {
        								if (dims == 3 &amp;&amp; this.getApiParam('analysis') == 'ca' &amp;&amp; this.getCorpus().getDocumentsCount() == 3) {
        									dims = 2;
        									// TODO add info message 'Because of the nature of Correspondence Analysis, you can only use 2 dimensions with 3 documents.'
        									return false;
        								}
        								
        								this.setApiParam('dimensions', dims);
        								this.loadFromApis(true);
    								}
    							}
    						},
    						scope: this
    					}
            		}
        		},{
        			itemId: 'reloadButton',
        			text: this.localize('reload'),
        			glyph: 'xf021@FontAwesome',
        			handler: function() {
        				this.loadFromApis();
        			},
        			scope: this
        		}]
        	},{
        		itemId: 'termsGrid',
        		xtype: 'grid',
        		title: this.localize('terms'),
        		region: 'east',
        		width: 250,
        		split: true,
        		collapsible: true,
        		collapseMode: 'header',
        		forceFit: true,
        		features: [{
        			ftype: 'grouping',
        			hideGroupedHeader: true,
                    enableGroupingMenu: false
        		}],
        		bbar: {
                    overflowHandler: 'scroller',
        			items: [{
        				itemId: 'nearbyButton',
                        xtype: 'button',
                        text: this.localize('nearby'),
                        glyph: 'xf0b2@FontAwesome',
                        flex: 1,
                        handler: function(btn) {
                        	var sel = btn.up('panel').getSelection()[0];
                        	if (sel === undefined) {
                        		this.toastError({
                        			html: this.localize("noTermSelected"),
                        		     anchor: btn.up("panel").getTargetEl()
                        		 });
                        	}
                        	else {
	                        	var term = sel.get('term');
	                        	this.getNearbyForTerm(term);
                        	}
                        },
                        scope: this
                    },{
                    	itemId: 'removeButton',
                        xtype: 'button',
                        text: this.localize('remove'),
                        glyph: 'xf068@FontAwesome',
                        flex: 1,
                        handler: function(btn) {
                        	var sel = btn.up('panel').getSelection()[0];
                        	if (sel === undefined) {
                        		this.toastError({
                        			html: this.localize("noTermSelected"),
                        		     anchor: btn.up("panel").getTargetEl()
                        		 });
                        	}
                        	else {
	                        	var term = sel.get('term');
	                        	this.removeTerm(term);
                        	}
                        },
                        scope: this
                    }]
        			
        		},
        		tbar: {
                    overflowHandler: 'scroller',
                    items: [{
                    	xtype: 'querysearchfield',
                    	itemId: 'addTerms',
//                    	emptyText: this.localize('addTerm'),
                    	flex: 1
                    }]
                },
        		columns: [{
        			text: this.localize('term'),
    				dataIndex: 'term',
    				flex: 1,
                    sortable: true
    			},{
    				text: this.localize('rawFreq'),
    				dataIndex: 'rawFreq',
    				flex: 0.75,
    				minWidth: 70,
                    sortable: true
    			},{
    				text: this.localize('relFreq'),
    				dataIndex: 'relativeFreq',
    				flex: 0.75,
    				minWidth: 70,
                    sortable: true,
                    hidden: true
    			}],
    			selModel: {
    				type: 'rowmodel',
    				mode: 'SINGLE',
    				allowDeselect: true,
    				toggleOnClick: true,
                    listeners: {
                        selectionchange: {
                        	fn: function(sm, selections) {
//                        		this.getApplication().dispatchEvent('corpusTermsClicked', this, selections);
                        		var sel = selections[0];
                        		if (sel !== undefined) {
	                        		var term = sel.get('term');
	                        		var isDoc = sel.get('category') === 'document';
	                        		this.selectTerm(term, isDoc);
	                        		
	                        		if (isDoc) {
	                        			this.queryById('nearbyButton').disable();
	                        			this.queryById('removeButton').disable();
	                        		} else {
	                        			this.queryById('nearbyButton').enable();
	                        			this.queryById('removeButton').enable();
	                        		}
                        		} else {
                        			this.selectTerm();
                        		}
                        	},
                        	scope: this
                        }
                    }
                },
        		store: this.getTermStore(),
        		listeners: {
        			expand: function(panel) {
        				panel.getView().refresh();
        			},
        			query: function(component, value) {
        				if (value.length > 0 &amp;&amp; this.getTermStore().findExact('term', value[0]) === -1) {
	                		this.setNewTerm(value);
	                		this.loadFromApis();
    					} else {
    						this.setNewTerm(null);
    					}
        			},
        			scope: this
        		}
        	}]
        });
        
        this.on('boxready', function(component, width, height) {
			if (width &lt; 400) {
				this.queryById('optionsPanel').collapse();
				this.queryById('termsGrid').collapse();
			}
			if (this.config.storeClass &amp;&amp; this.config.storeData) {
				this.loadStoreFromJson(this.config.storeClass, this.config.storeData);
			}
		}, this);
        
        this.on('beforedestroy', function(component) {
        	var oldChart = this.queryById('chart');
        	if (oldChart !== null) {
        		this.queryById('chartParent').remove(oldChart);
        	}
        }, this);
        
        // create a listener for corpus loading (defined here, in case we need to load it next)
    	this.on('loadedCorpus', function(src, corpus) {
    		function setCheckItemFromApi(apiParamName) {
    			var value = this.getApiParam(apiParamName);
    			var menu = this.queryById(apiParamName);
    			var item = menu.down('#'+apiParamName+'_'+value);
    			item.setChecked(true);
    		}
    		var setCheckBound = setCheckItemFromApi.bind(this);
    		
    		setCheckBound('analysis');
    		this.doAnalysisChange(this.getApiParam('analysis'));
    		
    		setCheckBound('comparisonType');
    		setCheckBound('clusters');

    		this.queryById('perplexity').setValue(this.getApiParam('perplexity'));
    		this.queryById('iterations').setValue(this.getApiParam('iterations'));
    		
    		if (corpus.getDocumentsCount() == 3) {
    			this.setApiParam('dimensions', 2);
    		}
    		setCheckBound('dimensions');

    		this.getCaStore().setCorpus(corpus);
    		this.getPcaStore().setCorpus(corpus);
    		this.getDocSimStore().setCorpus(corpus);
    		this.loadFromApis();
    	}, this);
    	
    	this.on('documentsSelected', function(src, docIds) {
    		this.setApiParam('docId', docIds);
    		this.loadFromApis();
    	}, this);
        
    	this.callParent(arguments);
    },
    
    doAnalysisChange: function(analysis) {
    	this.setApiParam('analysis', analysis);
		this.queryById('nearbyButton').setDisabled(analysis === 'tsne');
		this.queryById('reloadButton').setVisible(analysis === 'tsne');
		this.queryById('perplexity').setVisible(analysis === 'tsne');
		this.queryById('iterations').setVisible(analysis === 'tsne');
		if (analysis === 'ca') {
			// TODO handling for when there's no corpus
			if (this.getCorpus().getDocumentsCount() == 3) {
				this.setApiParam('dimensions', 2);
				this.queryById('dimensions').menu.items.get(0).setChecked(true); // need 1-2 docs or 4+ docs for 3 dimensions
			}
		}
    },
    
    loadStoreFromJson: function(storeClass, storeData) {
		if (storeClass == 'Voyant.data.store.CAAnalysis') {
			this.getCaStore().loadRawData(storeData);
			this.doAnalysisChange('ca');
			this.maskAndBuildChart.call(this, this.getCaStore());
		} else if (storeClass == 'Voyant.data.store.PCAAnalysis') {
			this.getPcaStore().loadRawData(storeData);
			this.doAnalysisChange('pca');
			this.maskAndBuildChart.call(this, this.getPcaStore());
		} else if (storeClass == 'Voyant.data.store.TSNEAnalysis') {
			this.getTsneStore().loadRawData(storeData);
			this.doAnalysisChange('tsne');
			this.maskAndBuildChart.call(this, this.getTsneStore());
		} else if (storeClass == 'Voyant.data.store.DocSimAnalysis') {
			this.getDocSimStore().loadRawData(storeData);
			this.doAnalysisChange('docSim');
			this.maskAndBuildChart.call(this, this.getDocSimStore());
		}
    },
    
    maskAndBuildChart: function(store) {
    	this.queryById('chartParent').mask(this.localize('plotting'));
    	Ext.defer(this.buildChart, 50, this, [store]);
    },

    buildChart: function(store) {
    	var that = this; // needed for tooltip renderer
    	
    	var oldChart = this.queryById('chart');
    	if (oldChart !== null) {
    		this.queryById('chartParent').remove(oldChart);
    	}
    	
    	this.queryById('termsGrid').getSelectionModel().deselectAll();
    	
    	var rec = store.getAt(0);
        var numDims = this.getApiParam('dimensions');
        
    	var summary = '';    	
    	if (this.getApiParam('analysis') === 'pca') {
    		// calculate the percentage of original data represented by the dominant principal components
			var pcs = rec.getPrincipalComponents();
			var eigenTotal = 0;
			for (var i = 0; i &lt; pcs.length; i++) {
				var pc = pcs[i];
				eigenTotal += parseFloat(pc.get('eigenValue'));
			}
			if (eigenTotal == 0) {
				// do nothing
			} else {
				summary = this.localize('pcTitle')+'\n';
				var pcMapping = ['xAxis', 'yAxis', 'fill'];
				for (var i = 0; i &lt; pcs.length; i++) {
					if (i >= numDims) break;
					
					var eigenValue = pcs[i].get('eigenValue');
					var percentage = eigenValue / eigenTotal * 100;
					summary += this.localize('pc')+' '+(i+1)+' ('+this.localize(pcMapping[i])+'): '+Math.round(percentage*100)/100+'%\n';
				}
			}
    	} else if (this.getApiParam('analysis') === 'tsne') {
    		
    	} else {
    		summary = this.localize('caTitle')+'\n';
    		var pcMapping = ['xAxis', 'yAxis', 'fill'];
    		
    		var dimensions = rec.getDimensions();
    		for (var i = 0; i &lt; dimensions.length; i++) {
    			if (i >= numDims) break;
    			
    			var percentage = dimensions[i].get('percentage');
    			summary += this.localize('dimension')+' '+(i+1)+' ('+this.localize(pcMapping[i])+'): '+Math.round(percentage*100)/100+'%\n';
    		}
    	}
        
        var maxFreq = 0;
        var minFreq = Number.MAX_VALUE;
        var maxFill = 0;
        var minFill = Number.MAX_VALUE;
        
        
        if (this.getApiParam('analysis') !== 'docSim') { // docSim doesn't return terms so keep the current ones
	        this.getTermStore().removeAll();
        }
	        
        var tokens = rec.getTokens();
        var termData = [];
        var docData = [];
        tokens.forEach(function(token) {
        	var freq = token.get('rawFreq');
        	var category = token.get('category');
        	if (category === undefined) {
        		category = 'term'; // some analyses don't define categories
        		token.set('category', 'term');
        	}
        	var isTerm = category === 'term';
        	if (isTerm) {
	        	if (freq > maxFreq) maxFreq = freq;
	        	if (freq &lt; minFreq) minFreq = freq;
        	}
        	if (this.getTermStore().findExact('term', token.get('term') === -1)) {
        		this.getTermStore().addSorted(token);
        	}
        	if (numDims === 3) {
				var z = token.get('vector')[2];
				if (z !== undefined) {
					if (z &lt; minFill) minFill = z;
					if (z > maxFill) maxFill = z;
				}
			}
        	var tokenData = {
        		x: token.get('vector')[0], y: token.get('vector')[1] || 0, z: token.get('vector')[2] || 0,
    			term: token.get('term'), rawFreq: freq, relativeFreq: token.get('relativeFreq'), cluster: token.get('cluster'), category: category,
    			disabled: false
        	};
        	if (!isTerm) {
        		if (token.get('category') === 'bin') {
        			tokenData.term = tokenData.title = "Bin "+token.get('docIndex');
        		} else {
	        		tokenData.docIndex = token.get('docIndex');
	        		var doc = this.getCorpus().getDocument(tokenData.docIndex);
	        		if (doc !== null) {
		        		tokenData.term = doc.getShortTitle();
		        		tokenData.title = doc.getTitle();
	        		}
        		}
        		docData.push(tokenData);
        	} else {
        		termData.push(tokenData);
        	}
        }, this);
        
        var newCount = this.getTermStore().getCount();
        this.queryById('limit').setRawValue(newCount);
        this.setApiParam('limit', newCount);
        
        
    	var termSeriesStore = Ext.create('Ext.data.JsonStore', {
    		fields: ['term', 'x', 'y', 'z', 'rawFreq', 'relativeFreq', 'cluster', 'category', 'docIndex', 'disabled'],
    		data: termData
    	});
    	var docSeriesStore = Ext.create('Ext.data.JsonStore', {
    		fields: ['term', 'x', 'y', 'z', 'rawFreq', 'relativeFreq', 'cluster', 'category', 'docIndex', 'disabled'],
    		data: docData
    	});
    	
    	var config = {
        	itemId: 'chart',
        	xtype: 'cartesian',
        	interactions: ['crosszoom','panzoom','itemhighlight'],
        	plugins: {
                ptype: 'chartitemevents'
            },
        	axes: [{
        		type: 'numeric',
        		position: 'bottom',
        		fields: ['x'],
        		label: {
                    rotate:{degrees:-30}
            	}
        	},{
        		type: 'numeric',
        		position: 'left',
        		fields: ['y']
        	}],
        	sprites: [{
        		type: 'text',
        		text: summary,
        		x: 70,
        		y: 70
        	}],
        	innerPadding: {top: 25, right: 25, bottom: 25, left: 25},
        	series: [{
        		type: 'customScatter',
        		xField: 'x',
        		yField: 'y',
        		store: termSeriesStore,
        		label: {
        			font: '14px Helvetica',
        			field: 'term',
        			display: 'over'
        		},
        		tooltip: {
        			trackMouse: true,
        			style: 'background: #fff',
        			renderer: function (toolTip, record, ctx) {
        				toolTip.setHtml(that.tokenFreqTipTemplate.apply([record.get('term'),record.get('rawFreq'),record.get('relativeFreq')]));
        			}
        		},
        		marker: {
        		    type: 'circle'
        		},
        		highlight: {
        			fillStyle: 'yellow',
                    strokeStyle: 'black'
        		},
        		renderer: function (sprite, config, rendererData, index) {
    				var store = rendererData.store;
    				var item = store.getAt(index);
    				if (item !== null) {
	    				var clusterIndex = item.get('cluster');
	    				var scatterplot = that;
	    				
	    				if (clusterIndex === -1) {
	    					// no clusters were specified in initial call
	    					clusterIndex = 0;
	    				}
	    				
	    				var fillAlpha = 0.65;
	    				var strokeAlpha = 1;
	    				if (item.get('disabled') === true) {
	    					fillAlpha = 0.1;
	    					strokeAlpha = 0.1;
	    				} else if (numDims === 3 &amp;&amp; item.get('z')) {
	    					fillAlpha = scatterplot.interpolate(item.get('z'), minFill, maxFill, 0, 1);
	    				}
	    				var color = scatterplot.getApplication().getColor(clusterIndex);
	    				config.fillStyle = 'rgba('+color.join(',')+','+fillAlpha+')';
	    				config.strokeStyle = 'rgba('+color.join(',')+','+strokeAlpha+')';
	    				
	    				var freq = item.get('rawFreq');
	    				var radius = scatterplot.interpolate(freq, minFreq, maxFreq, 2, 20);
	    				config.radius = radius;
    				}
    			},
    			scope: this
        	},{
        		type: 'customScatter',
        		xField: 'x',
        		yField: 'y',
        		store: docSeriesStore,
        		label: {
        			font: '14px Helvetica',
        			field: 'term',
        			display: 'over',
        			color: this.getDefaultDocColor(true)
        		},
        		tooltip: {
        			trackMouse: true,
        			style: 'background: #fff',
        			renderer: function (toolTip, record, ctx) {
        				toolTip.setHtml(that.docFreqTipTemplate.apply([record.get('title'),record.get('rawFreq')]));
        			}
        		},
        		marker: {
        		    type: 'diamond'
        		},
        		highlight: {
        			fillStyle: 'yellow',
                    strokeStyle: 'black'
        		},
        		renderer: function (sprite, config, rendererData, index) {
    				var store = rendererData.store;
    				var item = store.getAt(index);
    				if (item !== null) {
	    				var clusterIndex = item.get('cluster');
	    				var scatterplot = that;
	    				
	    				var color;
	    				if (clusterIndex === -1 || scatterplot.getApiParam('analysis') !== 'docSim') {
	    					color = scatterplot.getDefaultDocColor();
	    				} else {
	    					color = scatterplot.getApplication().getColor(clusterIndex);	
	    				}
	    				
	    				var a = 0.65;
	    				if (numDims === 3 &amp;&amp; item.get('z')) {
	    					a = scatterplot.interpolate(item.get('z'), minFill, maxFill, 0, 1);
	    				}
	    				
	    				config.fillStyle = 'rgba('+color.join(',')+','+a+')';
	    				config.strokeStyle = 'rgba('+color.join(',')+',1)';
	    				config.radius = 5;
    				}
    			},
    			scope: this
        		
        		
        	}],
        	listeners: {
        		itemclick: function(chart, item, event) {
        			var data = item.record.data;
        			if (data.category === 'doc') {
        				var record = this.getCorpus().getDocument(data.docIndex);
	            		this.getApplication().dispatchEvent('documentsClicked', this, [record]);
        			} else if (data.category === 'term') {
	        			var record = Ext.create('Voyant.data.model.CorpusTerm', data);
	            		this.getApplication().dispatchEvent('corpusTermsClicked', this, [record]);
        			}
        		},
        		render: function(chart) {
        			chart.body.on('contextmenu', function(event, target) {
	        			event.preventDefault();
	        			
		            	var xy = event.getXY();
		            	var parentXY = Ext.fly(target).getXY();
		            	var x = xy[0] - parentXY[0];
		            	var y = xy[1] - parentXY[1];
		            	var chartItem = this.down('#chart').getItemForPoint(x,y);
		            	if (chartItem != null &amp;&amp; chartItem.record.get('category') === 'term') {
		            		var series = this.down('#chart').getSeries();
		            		series[0].disableToolTips();
		            		series[1].disableToolTips();
		            		
		            		var term = chartItem.record.get('term');
		            		
		            		var text = (new Ext.Template(this.localize('removeTerm'))).apply([term]);
		            		this.getChartMenu().queryById('remove').setText(text);
		            		text = (new Ext.Template(this.localize('nearbyTerm'))).apply([term]);
		            		var nearby = this.getChartMenu().queryById('nearby');
		            		nearby.setText(text);
		            		nearby.setDisabled(this.getApiParam('analysis') === 'tsne');
		            		
		            		this.getChartMenu().on('click', function(menu, item) {
		            			if (item !== undefined) {
		            				var term = chartItem.record.get('term');
			            			if (item.getItemId() === 'nearby') {
			            				this.getNearbyForTerm(term);
			            			} else {
			            				this.removeTerm(term);
			            			}
		            			}
		            		}, this, {single: true});
		            		this.getChartMenu().showAt(xy);
		            	}
		            }, this);
        		},
        		scope: this
        	}
        };
    	
    	var chart = Ext.create('Ext.chart.CartesianChart', config);
    	this.queryById('chartParent').insert(0, chart);
    	
    	this.queryById('chartParent').unmask();
    	
    	this.doLabels();
    	
    	if (this.getNewTerm() !== null) {
        	this.selectTerm(this.getNewTerm()[0]);
        	this.setNewTerm(null);
        }
    },
    
    getDefaultDocColor: function(returnHex) {
    	var color = this.getApplication().getColor(6, returnHex);
    	return color;
    },
    
    doLabels: function() {
    	var chart = this.queryById('chart');
    	var series = chart.getSeries();
    	var summary = chart.getSurface('chart').getItems()[0];
    	var labels = this.getApiParam("label");
    	if (labels.indexOf("summary")>-1) {summary.show();}
    	else {summary.hide();}
    	if (labels.indexOf("terms")>-1) {series[0].getLabel().show();}
    	else {series[0].getLabel().hide();}
    	if (labels.indexOf("docs")>-1) {series[1].getLabel().show();}
    	else {series[1].getLabel().hide();}
    },
    
    selectTerm: function(term, isDoc) {
    	var chart = this.down('#chart');
    	if (chart !== null) {
	    	if (term === undefined) {
				chart.getSeries()[0].setHighlightItem(null);
				chart.getSeries()[1].setHighlightItem(null);
	    	} else {
		    	var series, index;
		    	if (isDoc === true) {
		    		series = chart.getSeries()[1];
			    	index = series.getStore().findExact('title', term);
		    	} else {
			    	series = chart.getSeries()[0];
			    	index = series.getStore().findExact('term', term);
		    	}
		    	if (index !== -1) {
		    		var record = series.getStore().getAt(index);
		    		var sprite = series.getSprites()[0];
		    		// constructing series item, like in the chart series source
		    		var item = {
						series: series,
		                category: series.getItemInstancing() ? 'items' : 'markers',
		                index: index,
		                record: record,
		                field: series.getYField(),
		                sprite: sprite
		    		};
		    		series.setHighlightItem(item);
		    		if (isDoc) {
		    			chart.getSeries()[0].setHighlightItem(null);
		    		} else {
		    			chart.getSeries()[1].setHighlightItem(null);
		    		}
		    		
		    		var point = this.getPointFromIndex(series, index);
		    		this.setHighlightData({x: point[0], y: point[1], r: 50});
		    		
		    		if (this.getHighlightTask() == null) {
		    			this.setHighlightTask(Ext.TaskManager.newTask({
		        			run: this.doHighlight,
		        			scope: this,
		        			interval: 25,
		        			repeat: this.getHighlightData().r
		        		}));
		    		}
		    		this.getHighlightTask().restart();
		    	}
	    	}
    	}
    },
    
    getPointFromIndex: function(series, index) {
		var sprite = series.getSprites()[0];
		if (sprite.surfaceMatrix !== null) {
			var matrix = sprite.attr.matrix.clone().prependMatrix(sprite.surfaceMatrix);
			var dataX = sprite.attr.dataX[index];
			var dataY = sprite.attr.dataY[index];
			return matrix.transformPoint([dataX, dataY]);
		} else {
			return [0,0];
		}
    },
    
    doHighlight: function() {
    	var chart = this.down('#chart');
    	if (this.getHighlightData().r > 0) {
	    	var surf = chart.getSurface();
			var highlight = null;
			var items = surf.getItems();
			for (var i = 0; i &lt; items.length; i++) {
				var item = items[i];
				if (item.id == 'customHighlight') {
					highlight = item;
					break;
				}
			}
			if (highlight == null) {
				surf.add({
					id: 'customHighlight',
					type: 'circle',
					strokeStyle: 'red',
					fillStyle: 'none',
					radius: this.getHighlightData().r,
					x: this.getHighlightData().x,
					y: this.getHighlightData().y
				});
			} else {
				highlight.setAttributes({
					x: this.getHighlightData().x,
					y: this.getHighlightData().y,
					radius: this.getHighlightData().r
				});
				this.getHighlightData().r -= 1.5;
				if (this.getHighlightData().r &lt;= 0) {
					this.getHighlightData().r = 0;
					surf.remove(highlight, true);
				}
			}
			chart.redraw();
    	}
    },
    
    filterChart: function(query) {
    	if (Ext.isString(query)) query = [query];
    	var reQueries = [];
    	for (var i = 0; i &lt; query.length; i++) {
    		var re = new RegExp(query[i]);
    		reQueries.push(re);
    	}
    	
    	// filter terms
    	var chart = this.queryById('chart');
    	var series0 = chart.getSeries()[0];
    	var label0 = series0.getLabel();
    	series0.getStore().each(function(item) {
    		var match = false;
    		if (reQueries.length == 0) match = true;
    		else {
	    		for (var i = 0; i &lt; reQueries.length; i++) {
	    			match = match || reQueries[i].test(item.get('term'));
	    			if (match) break;
	    		}
    		}
    		item.set('disabled', !match);
    		var index = item.store.indexOf(item);
    		label0.setAttributesFor(index, {hidden: !match});
    	}, this);

		chart.redraw();
    },
    
    getCurrentTerms: function() {
    	var terms = [];
    	this.getTermStore().each(function(r) {
    		if (r.get('category') === 'term') {
    			terms.push(r.get('term'));
    		}
    	});
    	return terms;
    },
    
    getNearbyForTerm: function(term) {
    	var limit = Math.max(2000, Math.round(this.getCorpus().getWordTokensCount() / 100));
		this.setApiParams({limit: limit, target: term});
		this.loadFromApis();
		this.setApiParam('target', undefined);
    },
    
    removeTerm: function(term) {
    	var series = this.down('#chart').getSeries()[0];
    	var index = series.getStore().findExact('term', term);
    	series.getStore().removeAt(index);
    	
    	index = this.getTermStore().findExact('term', term);
    	this.getTermStore().removeAt(index);
    	
    	var newCount = this.getTermStore().getCount();
        this.queryById('limit').setRawValue(newCount);
    },
    
    loadFromApis: function(keepCurrentTerms) {
    	this.queryById('chartParent').mask(this.localize('analyzing'));
    	
    	var params = {};
    	var terms = this.getCurrentTerms();
    	if (this.getNewTerm() !== null) {
    		terms = terms.concat(this.getNewTerm());
    		this.setApiParam('limit', terms.length);
    	}
    	if (terms.length > 0) {
    		if (this.getNewTerm() !== null || keepCurrentTerms) {
    			params.query = terms.join(',');
    		}
//    		params.term = terms;
    	}
    	Ext.apply(params, this.getApiParams());
    	if (params.target != null) {
    		params.term = terms;
    	}
    	if (params.analysis === 'pca') {
    		this.getPcaStore().load({
	    		params: params
	    	});
    	} else if (params.analysis === 'tsne'){
    		this.getTsneStore().load({
	    		params: params
	    	});
    	} else if (params.analysis === 'docSim'){
    		this.getDocSimStore().load({
	    		params: params
	    	});
    	} else {
    		this.getCaStore().load({
	    		params: params
	    	});
    	}
    },
    
    interpolate: function(lambda, minSrc, maxSrc, minDst, maxDst) {
        return minDst + (maxDst - minDst) * Math.max(0, Math.min(1, (lambda - minSrc) / (maxSrc - minSrc)));
    }
});

/*
 * Adds tool tip disabling.
 */
Ext.define('Ext.chart.series.CustomScatter', {
	extend: 'Ext.chart.series.Scatter',
	
	alias: 'series.customScatter',
    type: 'customScatter',
    seriesType: 'scatterSeries',
	
	tipsDisabled: false,
	
	enableToolTips: function() {
		this.tipsDisabled = false;
	},
	
	disableToolTips: function() {
		this.tipsDisabled = true;
	},
	
    showTip: function (item, xy) {
    	if (this.tipsDisabled) {
    		return;
    	}
    	
    	this.callParent(arguments);
    }
});</code></pre>
        </article>
    </section>




</div>

<footer>
    <div class="footer-text"><a href='https://creativecommons.org/licenses/by/4.0/' style='text-decoration: none; color: black;'> Stfan Sinclair & Geoffrey Rockwell</a></div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
